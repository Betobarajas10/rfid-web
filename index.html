<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Control de Acceso - Historial</title>
</head>
<body>
  <h1>Control de Acceso - Historial</h1>

  <h2>Accesos Permitidos</h2>
  <table border="1">
    <thead>
      <tr><th>Nombre</th><th>UID</th><th>Fecha</th><th>Hora</th></tr>
    </thead>
    <tbody id="tablaPermitidos"></tbody>
  </table>

  <h2>Accesos Denegados</h2>
  <table border="1">
    <thead>
      <tr><th>UID</th><th>Fecha</th><th>Hora</th></tr>
    </thead>
    <tbody id="tablaDenegados"></tbody>
  </table>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC6T4wb8ZhNT55Tss8bOUGUNSRMlhz-brY",
      authDomain: "controlaccesoesp32-820ba.firebaseapp.com",
      databaseURL: "https://controlaccesoesp32-820ba-default-rtdb.firebaseio.com",
      projectId: "controlaccesoesp32-820ba",
      storageBucket: "controlaccesoesp32-820ba.appspot.com",
      messagingSenderId: "757059664709",
      appId: "1:757059664709:web:ea7c7f3f9e0f871162a273"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function mostrarAccesos() {
      const tablaPermitidos = document.getElementById("tablaPermitidos");
      tablaPermitidos.innerHTML = ""; // Limpiar

      db.ref("accesos").on("value", snapshot => {
        tablaPermitidos.innerHTML = "";
        snapshot.forEach(child => {
          const datos = child.val();
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${datos.nombre || "-"}</td>
            <td>${datos.uid || "-"}</td>
            <td>${datos.FECHA || "-"}</td>
            <td>${datos.hora || "-"}</td>
          `;
          tablaPermitidos.appendChild(tr);
        });
      });
    }

    function mostrarDenegados() {
      const tablaDenegados = document.getElementById("tablaDenegados");
      tablaDenegados.innerHTML = ""; // Limpiar

      db.ref("accesos_denegados").on("value", snapshot => {
        tablaDenegados.innerHTML = "";
        snapshot.forEach(child => {
          const datos = child.val();
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${datos.UID || "-"}</td>
            <td>${datos.FECHA || "-"}</td>
            <td>${datos.hora || "-"}</td>
          `;
          tablaDenegados.appendChild(tr);
        });
      });
    }

    // Ejecutar funciones al cargar
    mostrarAccesos();
    mostrarDenegados();
  </script>
</body>
</html>
