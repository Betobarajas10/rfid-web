<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Control de Acceso</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 800px;
      margin-bottom: 30px;
    }
    th, td {
      border: 1px solid #666;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #0b5394;
      color: white;
    }
    h2 {
      margin-top: 40px;
      color: #0b5394;
    }
  </style>
</head>
<body>

<h1>Control de Acceso - Historial</h1>

<h2>Accesos Permitidos</h2>
<table id="tablaAccesos">
  <thead>
    <tr><th>Nombre</th><th>UID</th><th>Fecha</th><th>Hora</th></tr>
  </thead>
  <tbody>
    <tr><td colspan="4">Cargando...</td></tr>
  </tbody>
</table>

<h2>Accesos Denegados</h2>
<table id="tablaDenegados">
  <thead>
    <tr><th>UID</th><th>Fecha</th><th>Hora</th></tr>
  </thead>
  <tbody>
    <tr><td colspan="3">Cargando...</td></tr>
  </tbody>
</table>

<script>
const urlAccesos = "https://controlaccesoesp32-820ba-default-rtdb.firebaseio.com/accesos.json";
const urlDenegados = "https://controlaccesoesp32-820ba-default-rtdb.firebaseio.com/accesos_denegados.json";

async function cargarAccesos() {
  try {
    const res = await fetch(urlAccesos);
    const data = await res.json();
    const tbody = document.querySelector("#tablaAccesos tbody");
    tbody.innerHTML = "";

    if (!data) {
      tbody.innerHTML = `<tr><td colspan="4">No hay registros disponibles</td></tr>`;
      return;
    }

    for (const key in data) {
      const acceso = data[key];
      const nombre = acceso.nombre || "Desconocido";
      const uid = acceso.uid || "-";
      const fecha = acceso.FECHA || acceso.fecha || "-";
      const hora = acceso.hora || "-";

      tbody.innerHTML += `<tr>
        <td>${nombre}</td>
        <td>${uid}</td>
        <td>${fecha}</td>
        <td>${hora}</td>
      </tr>`;
    }
  } catch (e) {
    console.error("Error cargando accesos:", e);
    document.querySelector("#tablaAccesos tbody").innerHTML = `<tr><td colspan="4">Error al cargar datos</td></tr>`;
  }
}

async function cargarDenegados() {
  try {
    const res = await fetch(urlDenegados);
    const data = await res.json();
    const tbody = document.querySelector("#tablaDenegados tbody");
    tbody.innerHTML = "";

    if (!data) {
      tbody.innerHTML = `<tr><td colspan="3">No hay registros disponibles</td></tr>`;
      return;
    }

    // Ordenar claves descendente para mostrar m√°s recientes arriba
    const clavesOrdenadas = Object.keys(data).sort().reverse();

    for (const key of clavesOrdenadas) {
      const acceso = data[key];
      const uid = acceso.UID || acceso.uid || "-";
      const fecha = acceso.FECHA || acceso.fecha || "-";
      const hora = acceso.hora || "-";

      tbody.innerHTML += `<tr>
        <td>${uid}</td>
        <td>${fecha}</td>
        <td>${hora}</td>
      </tr>`;
    }
  } catch (e) {
    console.error("Error cargando denegados:", e);
    document.querySelector("#tablaDenegados tbody").innerHTML = `<tr><td colspan="3">Error al cargar datos</td></tr>`;
  }
}

cargarAccesos();
cargarDenegados();
setInterval(() => {
  cargarAccesos();
  cargarDenegados();
}, 5000);

</script>
</body>
</html>
